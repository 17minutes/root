--- lib/ExecutionEngine/MCJIT/MCJIT.cpp
+++ lib/ExecutionEngine/MCJIT/MCJIT.cpp
@@ -200,6 +200,9 @@
 
   // If the cache did not contain a suitable object, compile the object
   if (!ObjectToLoad) {
+
+    OwnedModules.markModuleAsLoaded(M);
+
     ObjectToLoad = emitObject(M);
     assert(ObjectToLoad && "Compilation did not produce an object.");
   }
@@ -218,8 +221,6 @@
 
   Buffers.push_back(std::move(ObjectToLoad));
   LoadedObjects.push_back(std::move(*LoadedObject));
-
-  OwnedModules.markModuleAsLoaded(M);
 }
 
 void MCJIT::finalizeLoadedModules() {
